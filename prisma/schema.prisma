// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
	id        Int      @id @default(autoincrement())
	email     String   @unique
	password  String?
	name      String?
	isAdmin   Boolean  @default(false)
	createdAt DateTime @default(now())
	orders    Order[]
}

model Product {
	id         Int         @id @default(autoincrement())
	name       String
	slug       String      @unique
	excerpt    String	   @default("")
	description String?
	keyBenefits String[]    @default([])
	keyIngredients String[]    @default([])
	howToUse   String[]    @default([])
	suitableFor String[]    @default([])
	price      Int
	salePrice  Int?
	stock      Int         @default(0)
	images     String[]    @default([])
	createdAt  DateTime    @default(now())
	updatedAt  DateTime    @updatedAt
	orderItems OrderItem[]
}

model Order {
	id                      Int         @id @default(autoincrement())
	orderNumber             String      @unique @default(uuid())
	userId                  Int?
	user                    User?       @relation(fields: [userId], references: [id])
	email                   String?
	name                    String?
	phone                   String?
	shippingAddress         String
	note                    String?
	paymentSlipUrl          String?
	items                   OrderItem[]
	subtotal                Int
	discount                Int
	shipping                Int
	total                   Int
	status                  OrderStatus @default(PENDING_CONFIRMATION)
	placementTokenHash      String?
	placementTokenExpiresAt DateTime?
	placedAt                DateTime?
	verifiedAt              DateTime?
	createdAt               DateTime    @default(now())
	updatedAt               DateTime    @updatedAt
}

model OrderItem {
	id        Int     @id @default(autoincrement())
	orderId   Int
	order     Order   @relation(fields: [orderId], references: [id])
	productId Int?
	product   Product? @relation(fields: [productId], references: [id], onDelete: NoAction)
	name      String
	price     Int
	quantity  Int
}

model SiteSetting {
	id Int @id @default(1)
	globalDiscountPercent Int @default(25)
	freeShippingThreshold Int @default(3000)
	qrImageUrl String? // QR for payments
	updatedAt DateTime @updatedAt
}

enum OrderStatus {
	PENDING_CONFIRMATION
	PENDING_VERIFICATION
	VERIFIED
	REJECTED
	PROCESSING
	SHIPPED
	DELIVERED
	CANCELLED
}


